<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AvoiderIo - ë¬´ë£Œ ì˜¨ë¼ì¸ í”¼í•˜ê¸° ê²Œì„</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YS3B0F2RL5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // GA4 ì„¤ì • (ì¸¡ì • IDë¥¼ ì‹¤ì œ ë°›ì€ IDë¡œ êµì²´í•˜ì„¸ìš”)
        gtag('config', 'G-YS3B0F2RL5', {
            // ì¿ í‚¤ ì„¤ì •
            cookie_flags: 'SameSite=None;Secure',
            // ê°œì¸ì •ë³´ ë³´í˜¸ ì„¤ì •
            anonymize_ip: true,
            // ì‚¬ì´íŠ¸ ë‚´ ê²€ìƒ‰ ì¶”ì 
            site_speed_sample_rate: 100,
            // ì»¤ìŠ¤í…€ ì„¤ì •
            custom_map: {
                'custom_parameter_1': 'game_level',
                'custom_parameter_2': 'final_score'
            }
        });
        
        // ê²Œì„ ê´€ë ¨ ì´ë²¤íŠ¸ ì¶”ì  í•¨ìˆ˜ë“¤
        function trackGameStart() {
            gtag('event', 'game_start', {
                event_category: 'game',
                event_label: 'new_game',
                value: 1
            });
        }
        
        function trackGameOver(score, level, time) {
            gtag('event', 'game_over', {
                event_category: 'game',
                event_label: 'game_completed',
                value: score,
                custom_parameter_1: level,
                custom_parameter_2: score,
                game_time: time
            });
        }
        
        function trackLevelUp(level) {
            gtag('event', 'level_up', {
                event_category: 'game',
                event_label: 'level_progression',
                value: level
            });
        }
        
        function trackHighScore(score, isNewRecord) {
            gtag('event', 'high_score', {
                event_category: 'achievement',
                event_label: isNewRecord ? 'new_record' : 'high_score',
                value: score
            });
        }
        
        function trackLeaderboardView() {
            gtag('event', 'leaderboard_view', {
                event_category: 'engagement',
                event_label: 'leaderboard_opened'
            });
        }
        
        function trackSoundToggle(enabled) {
            gtag('event', 'sound_toggle', {
                event_category: 'settings',
                event_label: enabled ? 'sound_on' : 'sound_off'
            });
        }
    </script>
    
    <!-- í•„ìˆ˜ SEO ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="AvoiderIo - ì¥ì• ë¬¼ì„ í”¼í•´ ìµœëŒ€í•œ ì˜¤ë˜ ìƒì¡´í•˜ëŠ” ë¬´ë£Œ ì˜¨ë¼ì¸ ê²Œì„ì…ë‹ˆë‹¤. ê°€ì‹œ, ë ˆì´ì €, í­íƒ„ì„ í”¼í•˜ë©° ìµœê³  ê¸°ë¡ì— ë„ì „í•˜ì„¸ìš”!">
    <meta name="keywords" content="AvoiderIo, í”¼í•˜ê¸° ê²Œì„, ë¬´ë£Œ ê²Œì„, ì˜¨ë¼ì¸ ê²Œì„, ì›¹ ê²Œì„, ì•„ì¼€ì´ë“œ ê²Œì„, ìƒì¡´ ê²Œì„, ë¸Œë¼ìš°ì € ê²Œì„">
    <meta name="robots" content="index, follow">
    
    <!-- Google Search Console ì¸ì¦ íƒœê·¸ (ë°›ì€ ì½”ë“œë¡œ êµì²´) -->
    <!-- <meta name="google-site-verification" content="ì—¬ê¸°ì—_ë°›ì€_ì½”ë“œ_ì…ë ¥" /> -->
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://avoiderio.xyz">
    
    <!-- ê¸°ë³¸ íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- ë³´ì•ˆ í—¤ë” -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- ê°œë°œì ëª¨ë“œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        let DEVELOPER_MODE = true;

        window.toggleDevMode = function() {
            DEVELOPER_MODE = !DEVELOPER_MODE;
            console.log('ğŸ”§ ê°œë°œì ëª¨ë“œ:', DEVELOPER_MODE ? 'ON' : 'OFF');
        };

        document.addEventListener('keydown', function(e) {
            if (!DEVELOPER_MODE) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key)) ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ğŸš« ê°œë°œì ë„êµ¬ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì½”ë‚˜ë¯¸ ì½”ë“œ(â†‘â†‘â†“â†“â†â†’â†â†’)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return false;
                }
            }
        });

        document.addEventListener('contextmenu', function(e) {
            if (!DEVELOPER_MODE) {
                e.preventDefault();
                console.log('ğŸš« ìš°í´ë¦­ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì½”ë‚˜ë¯¸ ì½”ë“œ(â†‘â†‘â†“â†“â†â†’â†â†’)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return false;
            }
        });

        // ì½”ë‚˜ë¯¸ ì½”ë“œ
        let secretSequence = [];
        const SECRET_CODE = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight'];

        document.addEventListener('keydown', function(e) {
            secretSequence.push(e.code);
            
            if (secretSequence.length > SECRET_CODE.length) {
                secretSequence.shift();
            }
            
            if (secretSequence.length === SECRET_CODE.length && 
                secretSequence.every((key, index) => key === SECRET_CODE[index])) {
                
                DEVELOPER_MODE = true;
                console.clear();
                console.log('ğŸ® ë¹„ë°€ ì½”ë“œ ì…ë ¥ ì™„ë£Œ! ê°œë°œì ëª¨ë“œ í™œì„±í™”!');
                toggleDevMode();
                secretSequence = [];
            }
        });
    </script>
</head>
<body>
    <!-- SEOìš© ìˆ¨ê²¨ì§„ í—¤ë” -->
    <header style="position: absolute; left: -9999px;">
        <h1>AvoiderIo - ë¬´ë£Œ ì˜¨ë¼ì¸ í”¼í•˜ê¸° ê²Œì„</h1>
        <p>ì¥ì• ë¬¼ì„ í”¼í•´ ìµœëŒ€í•œ ì˜¤ë˜ ìƒì¡´í•˜ëŠ” ë¬´ë£Œ ì˜¨ë¼ì¸ ê²Œì„ì…ë‹ˆë‹¤. WASD í‚¤ë‚˜ ë°©í–¥í‚¤ë¡œ í”Œë ˆì´ì–´ë¥¼ ì›€ì§ì—¬ ê°€ì‹œ, ë ˆì´ì €, í­íƒ„ì„ í”¼í•˜ì„¸ìš”.</p>
    </header>

    <!-- ë³´ì•ˆ ê²½ê³  í‘œì‹œ ì˜ì—­ -->
    <div id="securityWarning" class="security-warning" style="display: none;">
        âš ï¸ ë¹„ì •ìƒì ì¸ í™œë™ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ê³µì •í•œ í”Œë ˆì´ë¥¼ ìœ„í•´ í˜‘ì¡°í•´ì£¼ì„¸ìš”.
    </div>
    
    <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div class="game-container" id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600" 
                aria-label="AvoiderIo ê²Œì„ í™”ë©´"
                role="img">
            ì´ ë¸Œë¼ìš°ì €ëŠ” Canvasë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìµœì‹  ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
        </canvas>
        
        <!-- ì¼ì‹œì •ì§€ ì˜¤ë²„ë ˆì´ -->
        <div class="pause-overlay" id="pauseOverlay" role="dialog" aria-labelledby="pauseTitle" aria-hidden="true">
            <div class="pause-menu">
                <h2 id="pauseTitle" class="pause-title">PAUSED</h2>
                <button class="pixel-button" onclick="resumeGame()" aria-label="ê²Œì„ ê³„ì†í•˜ê¸°">
                    CONTINUE
                </button>
                <button class="pixel-button" onclick="goToMainMenu()" aria-label="ë©”ì¸ ë©”ë‰´ë¡œ ì´ë™">
                    MAIN MENU
                </button>
            </div>
        </div>
        
        <!-- ê²Œì„ì˜¤ë²„ ì˜¤ë²„ë ˆì´ -->
        <div class="game-over-overlay" id="gameOverOverlay" role="dialog" aria-labelledby="gameOverTitle" aria-hidden="true">
            <div class="game-over-menu">
                <h2 id="gameOverTitle" class="game-over-title">GAME OVER</h2>
                <div class="final-score-display" aria-label="ìµœì¢… ì ìˆ˜">
                    <span id="finalScore">0</span>
                </div>
                <div class="stats" role="group" aria-label="ê²Œì„ í†µê³„">
                    <p>ë ˆë²¨: <span id="finalLevel" aria-label="ë„ë‹¬í•œ ë ˆë²¨">1</span></p>
                    <p>ìƒì¡´ ì‹œê°„: <span id="finalTime" aria-label="ìƒì¡´í•œ ì‹œê°„">0</span>ì´ˆ</p>
                </div>
                <button class="pixel-button" onclick="startGame()" aria-label="ê²Œì„ ë‹¤ì‹œ ì‹œì‘">
                    RETRY
                </button>
                <button class="pixel-button" onclick="goToMainMenu()" aria-label="ë©”ì¸ ë©”ë‰´ë¡œ ì´ë™">
                    MAIN MENU
                </button>
            </div>
        </div>
        
        <!-- ë¦¬ë”ë³´ë“œ ì˜¤ë²„ë ˆì´ -->
        <div class="leaderboard-overlay" id="leaderboardOverlay" role="dialog" aria-labelledby="leaderboardTitle" aria-hidden="true">
            <div class="leaderboard-menu">
                <h2 id="leaderboardTitle" class="leaderboard-title">LEADERBOARD</h2>
                <div class="leaderboard-list" id="leaderboardList" role="list" aria-label="ìˆœìœ„í‘œ">
                    <!-- ë¦¬ë”ë³´ë“œ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <button class="pixel-button" onclick="closeLeaderboard()" aria-label="ë¦¬ë”ë³´ë“œ ë‹«ê¸°">
                    CLOSE
                </button>
            </div>
        </div>
        
        <!-- ì´ë¦„ ì…ë ¥ ì˜¤ë²„ë ˆì´ -->
        <div class="name-input-overlay" id="nameInputOverlay" role="dialog" aria-labelledby="nameInputTitle" aria-hidden="true">
            <div class="name-input-menu">
                <h2 id="nameInputTitle" class="name-input-title">NEW RECORD!</h2>
                <p class="record-message">ì¶•í•˜í•©ë‹ˆë‹¤! ìƒˆë¡œìš´ ê¸°ë¡ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!</p>
                <div class="record-stats" role="group" aria-label="ë‹¬ì„±í•œ ê¸°ë¡">
                    <p>ì ìˆ˜: <span id="recordScore" aria-label="ë‹¬ì„±í•œ ì ìˆ˜">0</span></p>
                    <p>ë ˆë²¨: <span id="recordLevel" aria-label="ë„ë‹¬í•œ ë ˆë²¨">1</span></p>
                    <p>ìƒì¡´ ì‹œê°„: <span id="recordTime" aria-label="ìƒì¡´í•œ ì‹œê°„">0</span>ì´ˆ</p>
                </div>
                <div class="name-input-container">
                    <label for="playerName">ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                    <input type="text" 
                           id="playerName" 
                           maxlength="15" 
                           placeholder="í”Œë ˆì´ì–´"
                           autocomplete="off"
                           spellcheck="false"
                           aria-label="í”Œë ˆì´ì–´ ì´ë¦„ ì…ë ¥">
                </div>
                <button class="pixel-button" onclick="submitRecord()" aria-label="ê¸°ë¡ ë“±ë¡">
                    ë“±ë¡
                </button>
                <button class="pixel-button secondary" onclick="skipRecord()" aria-label="ê¸°ë¡ ë“±ë¡ ê±´ë„ˆë›°ê¸°">
                    ê±´ë„ˆë›°ê¸°
                </button>
            </div>
        </div>
        
        <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ì•ˆë‚´ -->
        <div class="bottom-controls" role="complementary" aria-label="ê²Œì„ ì¡°ì‘ë²•">
            <kbd>WASD</kbd>/<kbd>ë°©í–¥í‚¤</kbd>: ì´ë™ | <kbd>ESC</kbd>: ì¼ì‹œì •ì§€ | <kbd>Space</kbd>: ê²Œì„ ì‹œì‘
        </div>
    </div>

    <!-- JavaScript íŒŒì¼ë“¤ -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="sound.js"></script>
    <script src="leaderboard.js"></script>
    <script src="arena.js"></script>
    <script src="effects.js"></script>
    <script src="obstacle.js"></script>
    <script src="obstacle_spawner.js"></script>
    <script src="player.js"></script>
    <script src="game.js"></script>
    <script src="main.js"></script>
    
    <!-- ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('ê²Œì„ ì˜¤ë¥˜:', e.error);
            
            // Analyticsì— ì˜¤ë¥˜ ì´ë²¤íŠ¸ ì „ì†¡
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: e.error ? e.error.toString() : 'Unknown error',
                    fatal: false
                });
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', e.reason);
            
            // Analyticsì— Promise ê±°ë¶€ ì´ë²¤íŠ¸ ì „ì†¡
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: 'Unhandled Promise Rejection: ' + e.reason,
                    fatal: false
                });
            }
        });
        
        window.addEventListener('load', function() {
            console.log('AvoiderIo ê²Œì„ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    page_title: 'AvoiderIo Game',
                    page_location: window.location.href
                });
            }
            
            document.addEventListener('click', function initAudio() {
                if (typeof soundManager !== 'undefined') {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }
                    } catch (error) {
                        console.warn('ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    }
                }
                document.removeEventListener('click', initAudio);
            });
        });
        
        // ì‚¬ìš©ì ì„¸ì…˜ ì‹œê°„ ì¶”ì 
        let sessionStartTime = Date.now();
        window.addEventListener('beforeunload', function() {
            const sessionDuration = Math.round((Date.now() - sessionStartTime) / 1000);
            if (typeof gtag !== 'undefined') {
                gtag('event', 'session_duration', {
                    event_category: 'engagement',
                    value: sessionDuration
                });
            }
        });
    </script>
</body>
</html>