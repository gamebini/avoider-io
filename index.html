<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AvoiderIo - 무료 온라인 닷지 게임 (Free Online Dodge Game)</title>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-XXXXXXXXXX', {
            cookie_flags: 'SameSite=None;Secure',
            anonymize_ip: true,
            site_speed_sample_rate: 100,
            custom_map: {
                'custom_parameter_1': 'game_level',
                'custom_parameter_2': 'final_score'
            }
        });
        
        // Game Analytics Functions
        function trackGameStart() {
            gtag('event', 'game_start', {
                event_category: 'game',
                event_label: 'new_game',
                value: 1
            });
        }
        
        function trackGameOver(score, level, time) {
            gtag('event', 'game_over', {
                event_category: 'game',
                event_label: 'game_completed',
                value: score,
                custom_parameter_1: level,
                custom_parameter_2: score,
                game_time: time
            });
        }
        
        function trackLevelUp(level) {
            gtag('event', 'level_up', {
                event_category: 'game',
                event_label: 'level_progression',
                value: level
            });
        }
        
        function trackHighScore(score, isNewRecord) {
            gtag('event', 'high_score', {
                event_category: 'achievement',
                event_label: isNewRecord ? 'new_record' : 'high_score',
                value: score
            });
        }
        
        function trackLeaderboardView() {
            gtag('event', 'leaderboard_view', {
                event_category: 'engagement',
                event_label: 'leaderboard_opened'
            });
        }
        
        function trackSoundToggle(enabled) {
            gtag('event', 'sound_toggle', {
                event_category: 'settings',
                event_label: enabled ? 'sound_on' : 'sound_off'
            });
        }
    </script>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="AvoiderIo - 장애물을 피해 최대한 오래 생존하는 무료 온라인 게임입니다. Dodge obstacles and survive as long as possible in this free online game!">
    <meta name="keywords" content="AvoiderIo, 피하기 게임, dodge game, 무료 게임, free game, 온라인 게임, online game, 웹 게임, web game, 아케이드 게임, arcade game, 생존 게임, survival game, 브라우저 게임, browser game">
    <meta name="robots" content="index, follow">
    
    <!-- Multilingual Meta -->
    <meta name="language" content="Korean, English">
    <link rel="alternate" hreflang="ko" href="https://avoiderio.xyz">
    <link rel="alternate" hreflang="en" href="https://avoiderio.xyz">
    <link rel="alternate" hreflang="x-default" href="https://avoiderio.xyz">
    
    <!-- Open Graph -->
    <meta property="og:title" content="AvoiderIo - 무료 온라인 피하기 게임 (Free Online Dodge Game)">
    <meta property="og:description" content="장애물을 피해 최대한 오래 생존하세요! Dodge obstacles and survive as long as possible!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://avoiderio.xyz">
    <meta property="og:site_name" content="AvoiderIo">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:locale:alternate" content="en_US">
    
    <!-- Google Search Console -->
    <!-- <meta name="google-site-verification" content="여기에_받은_코드_입력" /> -->
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://avoiderio.xyz">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Developer Mode Script -->
    <script>
        let DEVELOPER_MODE = true;

        window.toggleDevMode = function() {
            DEVELOPER_MODE = !DEVELOPER_MODE;
            console.log('🔧 개발자 모드 (Developer Mode):', DEVELOPER_MODE ? 'ON' : 'OFF');
        };

        document.addEventListener('keydown', function(e) {
            if (!DEVELOPER_MODE) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key)) ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('🚫 개발자 도구가 차단되었습니다 (Developer tools blocked). 코나미 코드를 입력하세요 (Enter Konami Code): ↑↑↓↓←→←→');
                    return false;
                }
            }
        });

        document.addEventListener('contextmenu', function(e) {
            if (!DEVELOPER_MODE) {
                e.preventDefault();
                console.log('🚫 우클릭이 차단되었습니다 (Right-click blocked). 코나미 코드를 입력하세요 (Enter Konami Code): ↑↑↓↓←→←→');
                return false;
            }
        });

        // Konami Code
        let secretSequence = [];
        const SECRET_CODE = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight'];

        document.addEventListener('keydown', function(e) {
            secretSequence.push(e.code);
            
            if (secretSequence.length > SECRET_CODE.length) {
                secretSequence.shift();
            }
            
            if (secretSequence.length === SECRET_CODE.length && 
                secretSequence.every((key, index) => key === SECRET_CODE[index])) {
                
                DEVELOPER_MODE = true;
                console.clear();
                console.log('🎮 비밀 코드 입력 완료! 개발자 모드 활성화! (Secret code complete! Developer mode activated!)');
                console.log('✨ 코나미 코드 (Konami Code): ↑↑↓↓←→←→');
                console.log('✅ 이제 우클릭이나 F12로 개발자 도구를 열 수 있습니다! (You can now open developer tools with right-click or F12!)');
                toggleDevMode();
                secretSequence = [];
            }
        });
    </script>
</head>
<body>
    <!-- SEO Header -->
    <header style="position: absolute; left: -9999px;">
        <h1>AvoiderIo - 무료 온라인 피하기 게임 (Free Online Dodge Game)</h1>
        <p>장애물을 피해 최대한 오래 생존하는 무료 온라인 게임입니다. WASD 키나 방향키로 플레이어를 움직여 가시, 레이저, 폭탄을 피하세요. 
        Dodge obstacles and survive as long as possible in this free online game. Use WASD keys or arrow keys to move your player and avoid spikes, lasers, and bombs.</p>
    </header>

    <!-- Security Warning -->
    <div id="securityWarning" class="security-warning" style="display: none;">
        ⚠️ 비정상적인 활동이 감지되었습니다. 공정한 플레이를 위해 협조해주세요. (Unusual activity detected. Please cooperate for fair play.)
    </div>
    
    <!-- Game Container -->
    <div class="game-container" id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600" 
                aria-label="AvoiderIo 게임 화면 (AvoiderIo Game Screen)"
                role="img">
            이 브라우저는 Canvas를 지원하지 않습니다. 최신 브라우저를 사용해주세요. (This browser does not support Canvas. Please use a modern browser.)
        </canvas>
        
        <!-- Pause Overlay -->
        <div class="pause-overlay" id="pauseOverlay" role="dialog" aria-labelledby="pauseTitle" aria-hidden="true">
            <div class="pause-menu">
                <h2 id="pauseTitle" class="pause-title">일시정지 (PAUSED)</h2>
                <button class="pixel-button" onclick="resumeGame()" aria-label="게임 계속하기 (Continue Game)">
                    계속하기 (CONTINUE)
                </button>
                <button class="pixel-button" onclick="goToMainMenu()" aria-label="메인 메뉴로 이동 (Go to Main Menu)">
                    메인 메뉴 (MAIN MENU)
                </button>
            </div>
        </div>
        
        <!-- Game Over Overlay -->
        <div class="game-over-overlay" id="gameOverOverlay" role="dialog" aria-labelledby="gameOverTitle" aria-hidden="true">
            <div class="game-over-menu">
                <h2 id="gameOverTitle" class="game-over-title">게임 오버 (GAME OVER)</h2>
                <div class="final-score-display" aria-label="최종 점수 (Final Score)">
                    <span id="finalScore">0</span>
                </div>
                <div class="stats" role="group" aria-label="게임 통계 (Game Statistics)">
                    <p>레벨 (Level): <span id="finalLevel" aria-label="도달한 레벨 (Reached Level)">1</span></p>
                    <p>생존 시간 (Survival Time): <span id="finalTime" aria-label="생존한 시간 (Survived Time)">0</span>초 (sec)</p>
                </div>
                <button class="pixel-button" onclick="startGame()" aria-label="게임 다시 시작 (Restart Game)">
                    다시 시도 (RETRY)
                </button>
                <button class="pixel-button" onclick="goToMainMenu()" aria-label="메인 메뉴로 이동 (Go to Main Menu)">
                    메인 메뉴 (MAIN MENU)
                </button>
            </div>
        </div>
        
        <!-- Leaderboard Overlay -->
        <div class="leaderboard-overlay" id="leaderboardOverlay" role="dialog" aria-labelledby="leaderboardTitle" aria-hidden="true">
            <div class="leaderboard-menu">
                <h2 id="leaderboardTitle" class="leaderboard-title">순위표 (LEADERBOARD)</h2>
                <div class="leaderboard-list" id="leaderboardList" role="list" aria-label="순위표 (Rankings)">
                    <!-- Leaderboard entries will be added here dynamically -->
                </div>
                <button class="pixel-button" onclick="closeLeaderboard()" aria-label="리더보드 닫기 (Close Leaderboard)">
                    닫기 (CLOSE)
                </button>
            </div>
        </div>
        
        <!-- Name Input Overlay -->
        <div class="name-input-overlay" id="nameInputOverlay" role="dialog" aria-labelledby="nameInputTitle" aria-hidden="true">
            <div class="name-input-menu">
                <h2 id="nameInputTitle" class="name-input-title">신기록! (NEW RECORD!)</h2>
                <p class="record-message">축하합니다! 새로운 기록을 달성했습니다! (Congratulations! You achieved a new record!)</p>
                <div class="record-stats" role="group" aria-label="달성한 기록 (Achieved Record)">
                    <p>점수 (Score): <span id="recordScore" aria-label="달성한 점수 (Achieved Score)">0</span></p>
                    <p>레벨 (Level): <span id="recordLevel" aria-label="도달한 레벨 (Reached Level)">1</span></p>
                    <p>생존 시간 (Survival Time): <span id="recordTime" aria-label="생존한 시간 (Survived Time)">0</span>초 (sec)</p>
                </div>
                <div class="name-input-container">
                    <label for="playerName">이름을 입력하세요 (Enter your name):</label>
                    <input type="text" 
                           id="playerName" 
                           maxlength="15" 
                           placeholder="플레이어 (Player)"
                           autocomplete="off"
                           spellcheck="false"
                           aria-label="플레이어 이름 입력 (Enter Player Name)">
                </div>
                <button class="pixel-button" onclick="submitRecord()" aria-label="기록 등록 (Submit Record)">
                    등록 (SUBMIT)
                </button>
                <button class="pixel-button secondary" onclick="skipRecord()" aria-label="기록 등록 건너뛰기 (Skip Record Registration)">
                    건너뛰기 (SKIP)
                </button>
            </div>
        </div>
        
        <!-- Bottom Controls -->
        <div class="bottom-controls" role="complementary" aria-label="게임 조작법 (Game Controls)">
            <kbd>WASD</kbd>/<kbd>방향키 (Arrow Keys)</kbd>: 이동 (Move) | <kbd>ESC</kbd>: 일시정지 (Pause) | <kbd>Space</kbd>: 게임 시작 (Start Game)
        </div>
    </div>

    <!-- Hidden Accessibility Info -->
    <div class="sr-only" id="gameInstructions">
        이 게임은 장애물을 피해 최대한 오래 생존하는 게임입니다. WASD 키나 방향키로 플레이어를 움직여 가시, 레이저, 폭탄을 피하세요. 하트 아이템을 먹으면 생명력이 회복됩니다.
        This is a survival game where you dodge obstacles to survive as long as possible. Use WASD keys or arrow keys to move your player and avoid spikes, lasers, and bombs. Collect heart items to restore your health.
    </div>

    <!-- JavaScript Files -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="sound.js"></script>
    <script src="leaderboard.js"></script>
    <script src="arena.js"></script>
    <script src="effects.js"></script>
    <script src="obstacle.js"></script>
    <script src="obstacle_spawner.js"></script>
    <script src="player.js"></script>
    <script src="game.js"></script>
    <script src="main.js"></script>
    
    <!-- Error Handling and Logging -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('게임 오류 (Game Error):', e.error);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: e.error ? e.error.toString() : 'Unknown error',
                    fatal: false
                });
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('처리되지 않은 Promise 거부 (Unhandled Promise Rejection):', e.reason);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: 'Unhandled Promise Rejection: ' + e.reason,
                    fatal: false
                });
            }
        });
        
        window.addEventListener('load', function() {
            console.log('AvoiderIo 게임이 성공적으로 로드되었습니다. (AvoiderIo game loaded successfully.)');
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    page_title: 'AvoiderIo Game',
                    page_location: window.location.href
                });
            }
            
            document.addEventListener('click', function initAudio() {
                if (typeof soundManager !== 'undefined') {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }
                    } catch (error) {
                        console.warn('오디오 컨텍스트 초기화 실패 (Audio context initialization failed):', error);
                    }
                }
                document.removeEventListener('click', initAudio);
            });
        });
        
        // Session time tracking
        let sessionStartTime = Date.now();
        window.addEventListener('beforeunload', function() {
            const sessionDuration = Math.round((Date.now() - sessionStartTime) / 1000);
            if (typeof gtag !== 'undefined') {
                gtag('event', 'session_duration', {
                    event_category: 'engagement',
                    value: sessionDuration
                });
            }
        });
    </script>
</body>
</html>